<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!-- <!doctype html public "-//W3C//DTD HTML 3.2//EN"> -->
<html>
  <head>
    <title>LANdialler: Routing Docs</title>
    <link rel="stylesheet" href="landialler.css" type="text/css">
  </head>

  <body bgcolor="#ffffff">
    <blockquote>

      <p align="center" class="toolbar">
	[&nbsp;<a
	href="./">home</a>&nbsp;|&nbsp;<a
	href="#routing">routing docs</a>&nbsp;|&nbsp;<a
	href="#scripts">debian scripts</a>&nbsp;]
      </p>

      <a name="routing">
      <h1>Routing Documentation</h1>

      <p>
	To be able to run the LANdialler server you need a Unix box
	configured to do some sort of Network Address Translation
	(NAT) or <a
	href="http://www.linuxdoc.org/HOWTO/IP-Masquerade-HOWTO-2.html#ss2.1">IP
	Masquerading</a>. You can use any modern Unix system, so long
	as it can run Python 2.1 software. I use <a
	href="http://www.linux.com/">Linux</a>, so I've included
	information on that here. You could use any of the BSD
	variants (e.g. <a href="http://www.freebsd.org/">FreeBSD</a>,
	<a href="http://www.openbsd.org/">OpenBSD</a>, <a
	href="http://www.netbsd.org/">NetBSD</a>), <a
	href="http://www.sun.com/software/solaris/">Solaris</a>,
	etc. instead if you prefer.
      </p>

      <p>
	If it wasn't for the excellent documentation then setting it
	up would be quite a long and painful process for the
	uninitiated. First find out which version of the Linux kernel
	you are running (type <kbd>uname&nbsp;-r</kbd>) and then
	follow the relevant links below.
      </p>
	    
      <ul>
	<li>
	  David Ranch's <a
	  href="http://www.linuxdoc.org/HOWTO/IP-Masquerade-HOWTO.html">Linux
	  IP Masquerade HOWTO</a> contains full instructions for Linux
	  kernel versions 2.0 and 2.2.
	  <p>
	</li>
	<li>
	  Rusty Russell's <a
	  href="http://netfilter.samba.org/unreliable-guides/">Unreliable
	  Guides</a> provide full coverage of the new routing features
	  of 2.4 kernels. Of particular use are the sections that tell
	  you how to configure a simple yet secure home firewall;
	  <p>
	  <ul>
	    <li>
	      <a
	      href="http://netfilter.samba.org/unreliable-guides/NAT-HOWTO/NAT-HOWTO.linuxdoc-4.html#ss4.1">I
	      just want masquerading! Help!</a>
	    </li>
	    <li>
	      <a
	      href="http://netfilter.samba.org/unreliable-guides/packet-filtering-HOWTO/packet-filtering-HOWTO.linuxdoc-5.html">Rusty's
		Really Quick Guide to Packet Filtering</a>
	    </li>
	  </ul>
	  <p>
	    I use kernel 2.4 on Debian Linux version 2.2 (yeah,
	    confusing isn't it). My scripts are shown below.
	  </p>
	</li>
      </ul>

      <a name="scripts"></a>
      <h1>Debian Scripts</h1>

      <p>
	These are the scripts that I use to run iptables on a Linux
	2.4 kernel. They provide both NAT and a firewall. I prefer the
	Debian distribution, which very cleverly lets you drop scripts
	in the <kbd>/etc/ppp/ip-up.d</kbd> directory to have them
	automatically run when dialling up.
      </p>

      <h2>packet-filter-up</h2>

      These commands are copied almost verbatim out of the HOWTOs
      mentioned above. If you have configured your kernel so that all
      the iptables functionality is compiled directly into the kernel
      (rather than as modules) then you should comment out all the
      <kbd>modprobe</kbd> or <kbd>insmod</kbd> commands.

      <pre>
#!/bin/sh
#
# $Id$
#
# Home firewall script, put together from commands in the NAT and
# packet filtering HOWTO documents.
#
# Suitable for dropping into /etc/ppp/ip-up.d if you're running
# Debian, to be automatically run by /usr/bin/pon after dial up.

# Load the NAT module (this pulls in all the others).
modprobe iptable_nat
# insmod ip_conntrack (autoloaded by iptable_nat by the looks of it)
insmod ip_conntrack_ftp

# Clear all current rules, so we start from a clean slate.
iptables -F

# Create chain which blocks new connections, except if coming from inside.
iptables -N block
iptables -A block -m state --state ESTABLISHED,RELATED -j ACCEPT
iptables -A block -m state --state NEW -i ! ppp0 -j ACCEPT
iptables -A block -j DROP

# Jump to that chain from INPUT and FORWARD chains.
iptables -A INPUT -j block
iptables -A FORWARD -j block

# In the NAT table (-t nat), Append a rule (-A) after routing
# (POSTROUTING) for all packets going out ppp0 (-o ppp0) which says to
# MASQUERADE the connection (-j MASQUERADE).
iptables -t nat -A POSTROUTING -o ppp0 -j MASQUERADE

# Turn on IP forwarding
echo 1 > /proc/sys/net/ipv4/ip_forward
      </pre>

      <h2>packet-filter-down</h2>

      This script cleans up when the dial up connection is closed
      down. I really ought to make it unload the kernel modules loaded
      by the <kbd>packet-filter-up</kbd> script...

      <pre>
#!/bin/sh
#
# $Id$
#
# Home firewall stop script.
#
# Suitable for dropping into /etc/ppp/ip-down.d if you're running
# Debian, to be automatically run by /usr/bin/pon after dial up.

# Turn off IP forwarding
echo 0 > /proc/sys/net/ipv4/ip_forward
      </pre>

      <p align="center" class="toolbar">
	[&nbsp;<a
	href="./">home</a>&nbsp;|&nbsp;<a
	href="#routing">routing docs</a>&nbsp;|&nbsp;<a
	href="#scripts">debian scripts</a>&nbsp;]
      </p>

      <hr>

      <table border="0" cellpadding="0" cellspacing="0">
	<tbody>
	  <tr>
	    <td align="left">
	      <a href="http://sourceforge.net/"><img
	      src="http://sourceforge.net/sflogo.php?group_id=34228"
	      width="88" height="31" border="0" alt="SourceForge
	      logo"></a>
	    </td>
	    <td>
	      &nbsp;&nbsp;
	    </td>
	    <td align="left" valign="top">
	      <font size="-1">
		Copyright &copy; 2001,
		Graham Ashton &lt;ashtong@users.sourceforge.net&gt;
	      </font>
	    </td>
	  </tr>
	</tbody>
      </table>

    </blockquote>
  </body>
</html>
